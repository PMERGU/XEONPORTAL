<div>
    <div small-header>
        <div class="hpanel" style="margin-bottom: 15px;">
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-12">
                        <h4 class="font-light m-b-xs tc-green-dark"
                            ng-show="purchaseOrder.id && purchaseOrder.state === 'PROCESSED'">
                            View Purchase Order : {{purchaseOrder.id}} binded to Sales Order : {{purchaseOrder.soNumber}}
                        </h4>
                        <h4 class="font-light m-b-xs"
                            ng-show="purchaseOrder.id && purchaseOrder.state !== 'PROCESSED'">
                            Purchase Order : {{purchaseOrder.id}}
                        </h4>
                        <h4 class="font-light m-b-xs" ng-hide="purchaseOrder.id">
                            Create new Purchase Order
                            <span has-authority="ROLE_USER">on behalf of </span>
                            <span ng-show="capturedAs.employee" class="text-info" >{{capturedAs.employee.firstName + ' ' + capturedAs.employee.lastName}}</span> for
                            <span ng-show="capturedAs.employee" class="text-info">{{capturedAs.company.name}}</span>
                        </h4>
                        <div class="pull-right" style="margin-top: -20px;">
                            <button class="btn btn-default" ng-click="clearPO()" ng-hide="purchaseOrder.id">
                                <span class="glyphicon glyphicon-ban-circle"></span>&nbsp;<span>Clear Form</span>
                            </button>
                            <button class="btn btn-primary2" ui-sref="purchaseOrder.comment" has-authority="ROLE_USER"
                                    ng-show="purchaseOrder.id">
                                <span>Comment</span>
                            </button>
                            <button class="btn btn-primary" ui-sref="purchaseOrder.process"
                                    ng-show="isXeon && purchaseOrder.id && purchaseOrder.state !== 'PROCESSED'">
                                <span>PROCESS PO</span>
                            </button>
                            <span ng-show="purchaseOrder.id && purchaseOrder.state === 'PROCESSING'" style="z-index: 999;font-size: 13px;position: absolute;top: 43px;color: #888;right: 25px;">
                                    by <strong>{{purchaseOrder.xeonUser.firstName}} {{purchaseOrder.xeonUser.lastName}}</strong>
                            </span>
                            <button class="btn btn-primary"
                                    ng-show="purchaseOrder.id && purchaseOrder.state === 'PROCESSED'">
                                <span>Fully {{purchaseOrder.state.toLowerCase()}}</span>
                            </button>
                        </div>
                        <div class="pull-right" style="position: absolute;right: 26px;bottom: -13px;" has-authority="ROLE_USER">
                            {{ isXeon == true ? 'XEON' : '' }}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <uib-alert type="info" close="closeAlert($index)" ng-show="purchaseOrder.comment"><strong>Comment : </strong>{{ purchaseOrder.comment }}</uib-alert>
                    </div>
                </div>
            </div>
            <jh-alert-error></jh-alert-error>
        </div>
        <div class="m" ng-show="uploadingAttachments">
            <div class="progress m-t-xs full progress-striped active animated">
                <div style="width: 1%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="90" role="progressbar" class="progress-bar progress-bar-success animated" ng-style="loadingWidth">
                </div>
            </div>
        </div>
    </div>
    <div class="hpanel">
        <form name="editForm" role="form" novalidate ng-submit="save()" show-validation>
            <div class="panel-heading hbuilt" ng-show="isXeon && !purchaseOrder.id">
                <div class="row">
                    <div class="col-md-2 text-right">
                        <h3>Company</h3>
                    </div>
                    <div class="col-md-3 text-right" style="margin-top: 10px;margin-bottom: 10px;">
                        <ui-select ng-model="capturedAs.company" title="Choose a company">
                            <ui-select-match placeholder="Select or search for company">{{$select.selected.name}}</ui-select-match>
                            <ui-select-choices repeat="company in companies | orderBy:'name' | filter: $select.search">
                                <span ng-bind-html="company.name | highlight: $select.search"></span>
                                <small ng-bind-html="' - [SapId: ' + company.sapId + ']' | highlight: $select.search"></small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-md-2 text-right" ng-show="employees">
                        <h3>Employee</h3>
                    </div>
                    <div class="col-md-3 text-right" style="margin-top: 10px;margin-bottom: 10px;" ng-show="employees">
                        <ui-select ng-model="capturedAs.employee" title="Choose a employee">
                            <ui-select-match placeholder="Select or search for employee">{{$select.selected.firstName + ' ' + $select.selected.lastName}}</ui-select-match>
                            <ui-select-choices repeat="employee in employees | orderBy:'firstName' | filter: $select.search">
                                <span ng-bind-html="employee.firstName + ' ' + employee.lastName | highlight: $select.search"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="panel-body p-xl" ng-show="purchaseOrder.id || (!isXeon || (isXeon && capturedAs.employee))">
                <div class="text-center">

                    <input ng-click="wizard.show(1)" style="width: 165px;margin: 0px 5px;" class="btn" type="button"
                           ng-class="{ 'btn-primary': step == 1, 'btn-default': step != 1}" value="Step 1 - Service"/>

                    <input ng-click="wizard.show(2)" style="width: 165px;margin: 0px 5px;" type="button" class="btn"
                           ng-class="{ 'btn-primary': step == 2, 'btn-default': step != 2}" value="Step 2 - Transport"/>

                    <input ng-click="wizard.show(3)" style="width: 165px;margin: 0px 5px;" type="button" class="btn"
                           ng-class="{ 'btn-primary': step == 3, 'btn-default': step != 3}" value="Step 3 - Cargo"
                           ng-disabled="purchaseOrder.pickUpParty.id === purchaseOrder.shipToParty.id" />

                    <input ng-click="wizard.show(4)" style="width: 165px;margin: 0px 5px;" role="button" class="btn"
                           ng-disabled="purchaseOrder.poLines.length === 0"
                           ng-class="{ 'btn-primary': step == 4, 'btn-default': step != 4}" value="Step 4 - Extra Info  "/>

                    <input ng-click="wizard.show(5)" style="width: 165px;margin: 0px 5px;" role="button"
                           class="btn"
                           ng-class="{ 'btn-primary': step == 5, 'btn-default': step != 5}" value="Step 5 - Attachments"/>

                    <input ng-click="wizard.show(6)" style="width: 165px;margin: 0px 5px;" type="button"
                           ng-disabled="editForm.$invalid || purchaseOrder.poLines.length === 0" class="btn"
                           ng-class="{ 'btn-primary': step == 6, 'btn-default': step != 6}" value="Step 6 - Confirmation"/>
                </div>
                <fieldset ng-disabled="purchaseOrder.id">
                    <div ng-show="step == 1" class="p-m">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label" for="field_poNumber">Purchase Order Number</label>
                                        <input type="text" class="form-control" name="poNumber" id="field_poNumber"
                                               ng-model="purchaseOrder.poNumber" ng-maxlength="35" ng-pattern="/^[a-zA-Z0-9]+$/"
                                               required/>
                                        <div ng-show="editForm.poNumber.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.poNumber.$error.required">
                                                required
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.poNumber.$error.maxlength">
                                                Max 35
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.poNumber.$error.pattern">
                                                only numeric and alpha-numeric characters allowed
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_reference">Reference</label>
                                        <input type="text" class="form-control" name="reference" id="field_reference"
                                               ng-model="purchaseOrder.reference" ng-maxlength="16"
                                               required/>
                                        <div ng-show="editForm.reference.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.reference.$error.required">
                                                required
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.reference.$error.maxlength">
                                                Max 16
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label"
                                               for="field_accountReference">AccountReference</label>
                                        <input type="text" class="form-control" name="accountReference"
                                               id="field_accountReference"
                                               ng-model="purchaseOrder.accountReference"  ng-maxlength="16"
                                               required/>
                                        <div ng-show="editForm.accountReference.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.accountReference.$error.required">
                                                required
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.accountReference.$error.maxlength">
                                                Max 16
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_collective">Collective</label>
                                        <input type="text" class="form-control" name="collective" id="field_collective"
                                               ng-model="purchaseOrder.collective" ng-maxlength="10"
                                               required/>
                                        <div ng-show="editForm.collective.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.collective.$error.required">
                                                required
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.collective.$error.maxlength">
                                                Max 10
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label class="control-label" for="field_service">Service</label>
                                        <select class="form-control" name="service"
                                                ng-model="purchaseOrder.service"
                                                id="field_service"
                                                ng-options="enum | prittyPrint for enum in staticEnums['services']">
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_serviceType">Service Type</label>
                                        <select class="form-control" name="serviceType"
                                                ng-model="purchaseOrder.serviceType"
                                                id="field_serviceType"
                                                ng-options="enum | prittyPrint for enum in staticEnums['serviceTypes']">
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_serviceLevel">Service Level</label>
                                        <select class="form-control" name="serviceLevel"
                                                ng-model="purchaseOrder.serviceLevel"
                                                ng-options="enum | prittyPrint for enum in staticEnums['serviceLevels']"
                                                id="field_serviceLevel">
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_vehicleSize">Vehicle Size</label>
                                        <select class="form-control" name="vehicleSize"
                                                ng-model="purchaseOrder.vehicleSize"
                                                id="field_vehicleSize" ng-required="requiredFields['vehicleSize']"
                                                ng-options="enum | prittyPrint for enum in staticEnums['vehicleSizes']">
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_labourRequired">Labour Count
                                            Needed</label>
                                        <input type="text" class="form-control" name="labourRequired"
                                               id="field_labourRequired"
                                               ng-model="purchaseOrder.labourRequired"
                                               ng-required="requiredFields['vehicleSize']"/>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_transportParty">Transport Party</label>
                                        <select class="form-control" name="transportParty"
                                                ng-model="purchaseOrder.transportParty"
                                                id="field_transportParty">
                                            <option value="CUSTOMER">Customer</option>
                                            <option value="XEON">Xeon</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-show="step == 2" class="p-m">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="field_pickUpParty">Collection From</label>
                                        <div class="input-group">
                                            <select class="form-control" id="field_pickUpParty" name="pickUpParty"
                                                    ng-required="requiredFields['pickUpParty']"
                                                    ng-model="purchaseOrder.pickUpParty"
                                                    ng-options="party as party.name for party in (otherParties | unique: 'id' | orderBy:'name') track by party.id">
                                            </select>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ui-sref="purchaseOrder.newParty({for: 'pickup', company: capturedAs.company})">
                                                    <i class="glyphicon glyphicon-plus"></i>
                                                </button>
                                            </span>
                                        </div>
                                        <div ng-show="editForm.pickUpParty.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.pickUpParty.$error.required">
                                                required
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_collectionDate">Collection Date</label>
                                        <div class="input-group">
                                            <input id="field_collectionDate" type="text" class="form-control"
                                                   name="collectionDate"
                                                   uib-datepicker-popup valid-date
                                                   ng-model="purchaseOrder.collectionDate"
                                                   datepicker-options="dateOptions"
                                                   ng-required="requiredFields['collectionDate']"
                                                   is-open="dateSetup.dpCollectionDate.opened"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpCollectionDate.open($event)"><i
                                                    class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                        </div>
                                        <div ng-show="editForm.collectionDate.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.collectionDate.$error.required">
                                                required
                                            </p>
                                        </div>
                                         <p class="help-block small-help-block pull-right"  ng-show="editForm.collectionDate.$error.currentStartDate">Collection Date must be on or after Current date.</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_collectionReference">Collection
                                            Reference</label>
                                        <input type="text" class="form-control" name="collectionReference"
                                               id="field_collectionReference"
                                               ng-model="purchaseOrder.collectionReference" ng-maxlength="10"
                                               ng-required="requiredFields['collectionReference']"
                                        />
                                        <div ng-show="editForm.collectionReference.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.collectionReference.$error.required">
                                                required
                                            </p>
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.collectionReference.$error.maxlength">
                                                Max 10
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label for="field_shipToParty">Delivery To</label>
                                        <div class="input-group">
                                            <select class="form-control" id="field_shipToParty" name="shipToParty"
                                                    ng-required="requiredFields['shipToParty']"
                                                    ng-model="purchaseOrder.shipToParty"
                                                    ng-options="party as party.name for party in (otherParties | unique: 'id' | orderBy:'name') track by party.id">
                                            </select>
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default"
                                                            ui-sref="purchaseOrder.newParty({for: 'dropoff'})">
                                                        <i class="glyphicon glyphicon-plus"></i>
                                                    </button>
                                                </span>
                                        </div>
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="purchaseOrder.pickUpParty.id === purchaseOrder.shipToParty.id">
                                            Both pickup and delivery are the same
                                        </p>
                                        <div ng-show="editForm.shipToParty.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.shipToParty.$error.required">
                                                required
                                            </p>
                                        </div>
                                        <div ng-show="purchaseOrder.pickUpParty === purchaseOrder.shipToParty">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.shipToParty.$error.required">
                                                Pickup and DropOff should not be the same
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label" for="field_dropOffDate">Delivery Date</label>
                                        <div class="input-group">
                                            <input type="text" id="field_dropOffDate" class="form-control"
                                                   uib-datepicker-popup  valid-date
                                                   ng-required="purchaseOrder['dropOffDate'] !== null"
                                                   name="dropOffDate" ng-required="requiredFields['dropOffDate']"
                                                   ng-model="purchaseOrder.dropOffDate" is-open="dateSetup.dpDropOff.opened"
                                                   datepicker-options="dateOptions" ng-required="true"
                                                   close-text="Close" min-date="minDate"/>
                                              <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpDropOff.open()"><i
                                                    class="glyphicon glyphicon-calendar"></i></button>
                                              </span>
                                        </div>
                                        <div ng-show="editForm.dropOffDate.$invalid">
                                            <p class="help-block small-help-block pull-right"
                                               ng-show="editForm.dropOffDate.$error.required">
                                                required
                                            </p>
                                        </div>
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.dropOffDate.$error.currentEndDate">Delivery Date must be on or after Current date.</p>
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.dropOffDate.$error.endBeforeStart">
                                            Delivery Date must be on or after Collection Date.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-show="step == 3" class="p-m">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label" for="field_cargoClassification">Hazardous
                                            Cargo</label>
                                        <select class="form-control" name="cargoClassification"
                                                ng-model="purchaseOrder.cargoClassification"
                                                id="field_cargoClassification">
                                            <option value="NON_HAZARDOUS">Non Hazardous</option>
                                            <option value="HAZARDOUS">Hazardous</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="control-label" for="field_cargoType">Hazardous
                                            Classification</label>
                                        <select class="form-control" name="cargoType" ng-model="purchaseOrder.cargoType"
                                                id="field_cargoType"
                                                ng-options="enum | prittyPrint for enum in staticEnums['cargoTypes']">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="table-responsive m-t">
                                    <table class="table table-striped">
                                        <thead >
                                        <tr ng-show="purchaseOrder.service === 'WAREHOUSING'">
                                            <th>No</th>
                                            <th>Material Number</th>
                                            <th>Batch No</th>
                                            <th>Unit of Measure</th>
                                            <th>Quantity</th>
                                            <th></th>
                                        </tr>
                                        <tr ng-show="purchaseOrder.service === 'TRANSPORT' && (purchaseOrder.poLines !== undefined && purchaseOrder.poLines[0].materialType === 'DEDICATED')">
                                            <th>No</th>
                                            <th>Gross Weight</th>
                                            <th>Volume</th>
                                            <th></th>
                                        </tr>
                                        <tr ng-show="purchaseOrder.service === 'TRANSPORT' && (!purchaseOrder.poLines || purchaseOrder.poLines[0].materialType !== 'DEDICATED')">
                                            <th>No</th>
                                            <th>Material Type</th>
                                            <th>Gross Weight</th>
                                            <th>DV Type</th>
                                            <th>Volume</th>
                                            <th>Quantity</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="po in purchaseOrder.poLines">
                                            <td>{{$index+1}}</td>
                                            <td ng-hide="po.materialType === 'DEDICATED'">
                                                <div>
                                                    <strong ng-hide="purchaseOrder.service === 'WAREHOUSING'">{{ po.materialType }}</strong>
                                                    <strong ng-show="purchaseOrder.service === 'WAREHOUSING'">{{ po.materialNumber }}</strong>
                                                </div>
                                            </td>
                                            <td ng-hide="purchaseOrder.service === 'WAREHOUSING'">
                                                <div>{{ po.grossWeight | number:3 }}kg</div>
                                                <small>
                                                    <b>{{ po.grossWeight * po.orderQuantity | number:3 }}</b>kg
                                                </small>
                                            </td>
                                            <td ng-hide="po.materialType === 'DEDICATED' && purchaseOrder.service === 'WAREHOUSING'">
                                                {{ po.dvType }}
                                            </td>
                                            <td ng-show="(po.dvType === null || po.dvType === 'DIMENSIONS') && purchaseOrder.service !== 'WAREHOUSING'">
                                                <div>{{ po.height * po.length * po.width / 1000000 |
                                                    number:3 }}m&sup3;</div>
                                                <small>
                                                    <b>{{(po.height * po.length * po.width)/1000000 * po.orderQuantity |
                                                        number:3 }}</b>m&sup3;
                                                </small>
                                            </td>
                                            <td ng-show="po.dvType === 'VOLUME'">
                                                <div>{{ po.volume| number:3  }}m&sup3;</div>
                                                <small>
                                                    <b>{{po.volume * po.orderQuantity | number:3 }}</b>m&sup3;
                                                </small>
                                            </td>
                                            <td ng-hide="po.materialType === 'DEDICATED'">
                                                {{ po.orderQuantity }}
                                            </td>
                                            <td width="95px">
                                                <div class="btn-group flex-btn-group-container">
                                                    <button class="btn btn-primary"
                                                            ui-sref="purchaseOrder.poLine({serviceType: purchaseOrder.serviceType, poLine: po})">
                                                        <span class="glyphicon glyphicon-pencil"></span>
                                                    </button>
                                                    <button type="button" ng-hide="po.materialType === 'DEDICATED'"
                                                            ng-click="deletePoLine(po.rowId)"
                                                            class="btn btn-danger">
                                                        <span class="glyphicon glyphicon-remove-circle"></span>
                                                        <span class="hidden-xs hidden-sm"></span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td colspan="8">
                                                <button class="btn btn-primary pull-right" ng-show="purchaseOrder.poLines[0].materialType !== 'DEDICATED'"
                                                        ui-sref="purchaseOrder.poLine({serviceType: purchaseOrder.serviceType})">
                                                    <span class="glyphicon glyphicon-plus"></span>
                                                </button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row m-t" ng-show="!purchaseOrder.poLines || purchaseOrder.poLines[0].materialType !== 'DEDICATED'">
                                    <div class="col-md-4 col-md-offset-8">
                                        <table class="table table-striped text-right">
                                            <tbody>
                                            <tr>
                                                <td><strong>Total Weight :</strong></td>
                                                <td><strong>{{ totalWeight | number:3 }}</strong>kg</td>
                                            </tr>
                                            <tr>
                                                <td><strong>Total cubes :</strong></td>
                                                <td><strong>{{ totalCubes | number:3 }}</strong>m&sup3;</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row" ng-show="purchaseOrder.poLines && purchaseOrder.poLines[0].materialType === 'DEDICATED' && (purchaseOrder.poLines[0].grossWeight === null || purchaseOrder.poLines[0].volume === null)">
                                    <div class="col-md-12">
                                        <div class="m-t">
                                            <blockquote class="blockquote-reverse" style="border-right: 5px solid #c0392b;">
                                                <p><strong>Weight and volume needed</strong></p>
                                                Please click the edit button above to insert the needed values.
                                            </blockquote>

                                        </div>
                                    </div>
                                </div>
                                <div class="row" ng-show="!purchaseOrder.poLines || purchaseOrder.poLines[0].materialType !== 'DEDICATED'">
                                    <div class="col-md-12">
                                        <div class="m-t">
                                            <blockquote class="blockquote-warn">
                                                <p><strong>Please remember</strong></p>
                                                Correct measurement and weight checks are crucial to ensure we can
                                                process your order as quickly as possible.
                                            </blockquote>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-show="step == 4" class="p-m">
                        <div class="modal-body">
                            <div class="col-md-6" ng-show="user.company.type === 'AGENT'">
                                <div class="form-group">
                                    <label for="field_soldToParty">Consignee</label>
                                    <div class="input-group" style="width: 100%">
                                        <select class="form-control" id="field_soldToParty" name="soldToParty" ng-required="user.company.type === 'AGENT'"
                                                ng-model="purchaseOrder.soldToParty"
                                                ng-options="party as party.name for party in (soldToParties | orderBy:'name') track by party.id">
                                            <option value=""></option>
                                        </select>
                                            <span class="input-group-btn" ng-show="isXeon">
                                                <button type="button" class="btn btn-default"
                                                        ui-sref="purchaseOrder.newParty({for: 'soldTo'})">
                                                    <i class="glyphicon glyphicon-plus"></i>
                                                </button>
                                            </span>
                                    </div>
                                    <div ng-show="editForm.soldToParty.$invalid">
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.soldToParty.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_tradeType">Trade Type</label>
                                    <select class="form-control" name="tradeType"
                                            ng-model="purchaseOrder.tradeType"
                                            id="field_tradeType"
                                            ng-options="enum | prittyPrint for enum in staticEnums['tradeTypes']">
                                    </select>
                                    <div ng-show="editForm.modeOfTransport.$invalid">
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.modeOfTransport.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_modeOfTransport">Mode of Transport</label>
                                    <select class="form-control" name="modeOfTransport" ng-required="user.company.type === 'AGENT'"
                                            ng-model="purchaseOrder.modeOfTransport"
                                            id="field_modeOfTransport"
                                            ng-options="enum | prittyPrint for enum in staticEnums['modeOfTransports']">
                                    </select>
                                    <div ng-show="editForm.modeOfTransport.$invalid">
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.modeOfTransport.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvName" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Carrier</label>
                                    <label class="control-label" for="field_cvName" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Carrier</label>
                                    <input type="text" class="form-control" name="cvName" id="field_cvName"
                                           ng-required="requiredFields['cvName']" ng-model="purchaseOrder.cvName"/>
                                    <div ng-show="editForm.cvName.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvName.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvEta" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Vessel ETA</label>
                                    <label class="control-label" for="field_cvEta" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Flight ETA</label>

                                    <div class="input-group">
                                        <input id="field_cvEta" type="text" class="form-control"
                                               name="cvEta"
                                               uib-datepicker-popup
                                               ng-model="purchaseOrder.cvEta"
                                               datepicker-options="dateOptions"
                                               ng-required="requiredFields['cvEta']"
                                               is-open="dateSetup.dpEta.opened"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpEta.open($event)"><i
                                                    class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                    </div>
                                    <div ng-show="editForm.cvEta.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvEta.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvOrigin" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Port of Load</label>
                                    <label class="control-label" for="field_cvOrigin" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Flight Origin</label>
                                    <input type="text" class="form-control" name="cvOrigin" id="field_cvOrigin"
                                           ng-required="requiredFields['cvOrigin']" ng-model="purchaseOrder.cvOrigin"/>
                                    <div ng-show="editForm.cvOrigin.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvOrigin.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label" for="field_cvConsol">Consol</label>
                                    <input type="text" class="form-control" name="cvConsol" id="field_cvConsol"
                                           ng-required="requiredFields['cvConsol']" ng-model="purchaseOrder.cvConsol"/>
                                    <div ng-show="editForm.cvConsol.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvConsol.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvShipper">Shipper</label>
                                    <input type="text" class="form-control" name="cvShipper" id="field_cvShipper"
                                           ng-required="requiredFields['cvShipper']" ng-model="purchaseOrder.cvShipper"/>
                                    <div ng-show="editForm.cvShipper.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvShipper.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvContainerNo">Container No</label>
                                    <input type="text" class="form-control" name="cvContainerNo" id="field_cvContainerNo"
                                           ng-required="requiredFields['cvContainerNo']" ng-model="purchaseOrder.cvContainerNo"/>
                                    <div ng-show="editForm.cvContainerNo.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvContainerNo.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvCarrierRef">Carrier Ref</label>
                                    <input type="text" class="form-control" name="cvCarrierRef" id="field_cvCarrierRef"
                                           ng-required="requiredFields['cvCarrierRef']" ng-model="purchaseOrder.cvCarrierRef"/>
                                    <div ng-show="editForm.cvCarrierRef.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvCarrierRef.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label" for="field_specialInstruction">Special Instruction</label>
                                    <textarea class="form-control" rows="5" name="specialInstruction"
                                              id="field_specialInstruction" ng-model="purchaseOrder.specialInstruction"></textarea>

                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvCommodity">Commodity</label>
                                    <input type="text" class="form-control" name="cvCommodity" id="field_cvCommodity"
                                           ng-required="requiredFields['cvCommodity']" ng-model="purchaseOrder.cvCommodity"/>
                                    <div ng-show="editForm.cvCommodity.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvCommodity.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvNumber" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Vessel / Voyage</label>
                                    <label class="control-label" for="field_cvNumber" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Flight Number</label>
                                    <input type="text" class="form-control" name="cvNumber" id="field_cvNumber"
                                           ng-required="requiredFields['cvNumber']" ng-model="purchaseOrder.cvNumber"/>
                                    <div ng-show="editForm.cvNumber.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvNumber.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvEtd" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Vessel ETD</label>
                                    <label class="control-label" for="field_cvEtd" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Flight ETD</label>
                                    <div class="input-group">
                                        <input id="field_cvEtd" type="text" class="form-control"
                                               name="cvEtd"
                                               uib-datepicker-popup
                                               ng-model="purchaseOrder.cvEtd"
                                               datepicker-options="dateOptions"
                                               ng-required="requiredFields['cvEtd']"
                                               is-open="dateSetup.dpEtd.opened"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpEtd.open($event)"><i
                                                    class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                    </div>
                                    <div ng-show="editForm.cvEtd.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvEtd.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label" for="field_cvDestination" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Port of Discharge</label>
                                    <label class="control-label" for="field_cvDestination" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Flight Destination</label>
                                    <input type="text" class="form-control" name="cvDestination" id="field_cvDestination"
                                           ng-required="requiredFields['cvDestination']" ng-model="purchaseOrder.cvDestination"/>
                                    <div ng-show="editForm.cvDestination.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvDestination.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvWaybill" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Master Ocean Way Bill</label>
                                    <label class="control-label" for="field_cvWaybill" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Master Air Way Bill</label>
                                    <input type="text" class="form-control" name="cvWaybill" id="field_cvWaybill"
                                           ng-required="requiredFields['cvWaybill']" ng-model="purchaseOrder.cvWaybill"/>
                                    <div ng-show="editForm.cvWaybill.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvWaybill.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvWaybillIssue" ng-show="purchaseOrder.modeOfTransport === 'SEA'">Master Ocean Way Bill Issue</label>
                                    <label class="control-label" for="field_cvWaybillIssue" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">Master Air Way Bill Issue</label>
                                    <div class="input-group">
                                        <input id="field_cvWaybillIssue" type="text" class="form-control"
                                               name="cvWaybillIssue"
                                               uib-datepicker-popup
                                               ng-model="purchaseOrder.cvWaybillIssue"
                                               datepicker-options="dateOptions"
                                               ng-required="requiredFields['cvWaybillIssue']"
                                               is-open="dateSetup.dpWaybillIssue.opened"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpWaybillIssue.open($event)"><i
                                                class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                    </div>
                                    <div ng-show="editForm.cvWaybillIssue.$invalid">
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.cvWaybillIssue.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvHouseWaybill" ng-show="purchaseOrder.modeOfTransport === 'SEA'">House Ocean Way Bill</label>
                                    <label class="control-label" for="field_cvHouseWaybill" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">House Air Way Bill </label>
                                    <input type="text" class="form-control" name="cvHouseWaybill" id="field_cvHouseWaybill"
                                           ng-required="requiredFields['cvHouseWaybill']" ng-model="purchaseOrder.cvHouseWaybill"/>
                                    <div ng-show="editForm.cvHouseWaybill.$invalid">
                                        <p class="help-block small-help-block pull-right" ng-show="editForm.cvHouseWaybill.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label" for="field_cvHouseWaybillIssue" ng-show="purchaseOrder.modeOfTransport === 'SEA'">House Ocean Way Bill Issue</label>
                                    <label class="control-label" for="field_cvHouseWaybillIssue" ng-hide="purchaseOrder.modeOfTransport === 'SEA'">House Air Way Bill Issue</label>
                                    <div class="input-group">
                                        <input id="field_cvHouseWaybillIssue" type="text" class="form-control"
                                               name="cvHouseWaybillIssue"
                                               uib-datepicker-popup
                                               ng-model="purchaseOrder.cvHouseWaybillIssue"
                                               datepicker-options="dateOptions"
                                               ng-required="requiredFields['cvHouseWaybillIssue']"
                                               is-open="dateSetup.dpHouseWaybillIssue.opened"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default"
                                                        ng-click="dateSetup.dpHouseWaybillIssue.open($event)"><i
                                                class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                    </div>
                                    <div ng-show="editForm.cvHouseWaybillIssue.$invalid">
                                        <p class="help-block small-help-block pull-right"
                                           ng-show="editForm.cvHouseWaybillIssue.$error.required">
                                            required
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-show="step == 5" class="p-m">
                        <div class="modal-body" ng-show="!purchaseOrder.id">
                            <div class="row">
                                <div class="col-md-12 text-center">
                                    <h3>Please add all documentation related to this order</h3>
                                </div>
                            </div>
                            <div class="row">
                                <div class="table-responsive m-t">
                                    <table class="table table-striped">
                                        <thead>
                                        <tr>
                                            <th width="60px">Id</th>
                                            <th width="180px">Category</th>
                                            <th>Description</th>
                                            <th width="300px">Drop Box</th>
                                            <th width="300px">Files Added</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="attachment in attachments">
                                            <td>{{$index+1}}</td>
                                            <td>
                                                <select class="form-control" name="category" ng-model="attachment.category" id="field_category"
                                                        ng-options="enum | prittyPrint for enum in staticEnums['attachmentCategories']">
                                                </select>
                                            </td>
                                            <td>
                                                <textarea class="form-control" rows="4" name="description" id="field_description" placeholder="Please type description for this attachment"
                                                          ng-model="attachment.description"></textarea>
                                            </td>
                                            <td>
                                                <div ngf-drop ngf-select ng-model="attachment.files" class="drop-box"
                                                     ngf-drag-over-class="'dragover'" ngf-multiple="true" ngf-allow-dir="true"
                                                     accept="image/*,application/pdf"
                                                     ngf-pattern="'image/*,application/pdf'" style="height: 86px; padding-top:28px; margin: 2px 0px;">
                                                    Drop pdfs or images here or click to upload
                                                </div>
                                                <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div>
                                            </td>
                                            <td>
                                                <div class="alert alert-success" ng-show="attachment.files" style="height: 86px;overflow: auto;padding: 6px;">
                                                    <ul>
                                                        <li ng-repeat="f in attachment.files" style="font:smaller">{{f.name}} {{f.$error}} {{f.$errorParam}}</li>
                                                    </ul>
                                                </div>
                                            </td>
                                            <td class="text-right">
                                                <div class="btn-group flex-btn-group-container">
                                                    <button type="button" class="btn btn-danger" ng-click="deleteAttachment($index)">
                                                        <span class="glyphicon glyphicon-remove-circle"></span>
                                                        <span class="hidden-xs hidden-sm"></span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>

                                        <tr>
                                            <td colspan="7">
                                                <button type="button" class="btn btn-primary pull-right" ng-click="addAttachment()">
                                                    <span class="glyphicon glyphicon-plus"></span>
                                                </button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="modal-body table-responsive" ng-show="purchaseOrder.id">
                            <table class="table table-striped table-condensed table-hover table-centered" >
                                <thead>
                                <tr>
                                    <th width="60px">Id</th>
                                    <th width="200px">Category</th>
                                    <th width="140px">Date Added</th>
                                    <th width="160px">Uploaded by</th>
                                    <th width="140px">Image Type</th>
                                    <th>Description</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="attachment in attachments | orderBy:'id'">
                                    <td>{{attachment.id}}</td>
                                    <td>{{attachment.category}}</td>
                                    <td>{{attachment.createdDate | date: 'yyyy-MM-dd HH:mm'}}</td>
                                    <td>{{attachment.user.firstName + ' ' + attachment.user.lastName}}</td>
                                    <td>{{attachment.mimeType}}</td>
                                    <td>{{attachment.description}}</td>
                                    <td>
                                        <button type="button" ng-click="downloadAttachment(attachment)" ng-disabled="isDownloadingAttachment" class="btn btn-primary btn-lg" style="height: 33px;padding-top: 5px;width: 70px;">
                                            <span class="glyphicon glyphicon-download" ng-show="selectedAttachment.id != attachment.id || !isDownloadingAttachment"></span>
                                            <span class="glyphicon glyphicon-refresh glyphicon-spin" ng-show="selectedAttachment.id == attachment.id && isDownloadingAttachment"></span>
                                            <span class="hidden-xs hidden-sm"></span>
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div ng-show="step == 6 && !(purchaseOrder.id && purchaseOrder.state === 'PROCESSED')">
                        <div class="row text-center m-t-lg m-b-lg">
                            <div class="col-lg-12">
                                <i class="pe-7s-check fa-5x text-muted" ng-show="orderApproved" ng-class="{'tc-green-dark': orderApproved}"></i>
                                <i class="pe-7s-close-circle fa-5x text-muted tc-red-dark" ng-show="!orderApproved"></i>
                                <p class="small m-t-md" ng-show="!orderApproved">
                                    <strong>Please confirm</strong> all details are correct and approve by clicking on the checkbox below
                                </p>
                                <p class="small m-t-md" ng-show="orderApproved">
                                    <strong>To finish the order, please click the submit button</strong>
                                </p>
                            </div>
                            <div class="checkbox col-lg-12">
                                <input icheck type="checkbox" ng-model="orderApproved"/>
                                Confirm new order
                            </div>
                        </div>
                    </div>
                    <div ng-show="step == 6 && (purchaseOrder.id && purchaseOrder.state === 'PROCESSED')">
                        <div class="row text-center m-t-lg m-b-lg">
                            <div class="col-lg-12">
                                <p class="small m-t-md">
                                    <i class="pe-7s-check fa-5x text-muted tc-green-dark"></i>
                                </p>
                                <p>
                                    <strong class="tc-green-dark">This order has been processed by our Xeon team already.</strong>
                                </p>
                                <br/>
                                <p>
                                    <strong>Sales order #{{purchaseOrder.soNumber}}</strong>
                                <div ng-show="purchaseOrder.soComment">
                                    <strong>
                                        Comment:
                                    </strong>
                                    <em>{{purchaseOrder.soComment}}</em>
                                </div>
                                </p>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="text-right m-t-xs">
                    <input ng-click="wizard.prev()" ng-disabled="step == 1" class="btn btn-default" type="button"
                           value="&nbsp;Previous&nbsp;"/>
                    <input ng-click="wizard.next()" ng-hide="step == 6" class="btn btn-primary" type="button" value="&nbsp;Next&nbsp;"
                           ng-disabled="step >= 5 && editForm.$invalid || isSaving || (purchaseOrder.poLines.length === 0 && step >= 3)
                                || (purchaseOrder.pickUpParty.id === purchaseOrder.shipToParty.id && step >= 2)
                                || (purchaseOrder.poLines && step >= 3 && purchaseOrder.poLines[0].materialType === 'DEDICATED' && (purchaseOrder.poLines[0].grossWeight === null || purchaseOrder.poLines[0].volume === null))"
                           />
                    <button ng-click="submit()"
                            ng-show="step == 6 && !(purchaseOrder.id && purchaseOrder.state === 'PROCESSED') && (purchaseOrder.pickUpParty.id !== purchaseOrder.shipToParty.id)"
                            class="btn btn-primary"
                            ng-disabled="editForm.$invalid || !orderApproved || isSaving">
                        <span class="glyphicon glyphicon-save"></span>&nbsp;<span>Submit Order</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

